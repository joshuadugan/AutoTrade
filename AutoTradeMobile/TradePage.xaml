<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="AutoTradeMobile.TradePage"
             xmlns:ViewModel="clr-namespace:AutoTradeMobile.ViewModels"
             x:DataType="ViewModel:TradePageViewModel"
             xmlns:chart="clr-namespace:Syncfusion.Maui.Charts;assembly=Syncfusion.Maui.Charts"
             Title="Trade"
             >

    <ContentPage.Resources>

        <Style x:Key="WhiteLabel" TargetType="Label">
            <Setter Property="TextColor" Value="White" />
        </Style>

    </ContentPage.Resources>

    <Grid>

        <Grid.RowDefinitions>
            <RowDefinition Height="2*" />
            <RowDefinition Height="60"/>
            <RowDefinition />
            <RowDefinition Height="60" />
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>

        <chart:SfCartesianChart Grid.ColumnSpan="2"
                                IsVisible="{Binding IsTraderRunning}"
                                >

            <chart:SfCartesianChart.XAxes>
                <chart:CategoryAxis/>
            </chart:SfCartesianChart.XAxes>

            <chart:SfCartesianChart.YAxes>
                <chart:NumericalAxis/>
            </chart:SfCartesianChart.YAxes>

            <chart:CandleSeries  
                        EnableTooltip="True"
                        EnableSolidCandle="True"
                        ItemsSource="{Binding TradingData.Minutes}" 
                        XBindingPath="TradeMinute" 
                        Open="Open"
                        High="High"
                        Low="Low"
                        Close="Close"
                        />

        </chart:SfCartesianChart>

        <FlexLayout Grid.Row="1" Grid.ColumnSpan="2" BackgroundColor="{Binding TradingData.LastMinute.MinuteColor}" 
                        JustifyContent="SpaceAround"
                        >
            <FlexLayout Direction="Column">
                <Label Style="{StaticResource WhiteLabel}" Text="Time" />
                <Label Style="{StaticResource WhiteLabel}" Text="{Binding TradingData.LastMinute.TradeMinute}" />
            </FlexLayout>
            <FlexLayout Direction="Column">
                <Label Style="{StaticResource WhiteLabel}" Text="Open"/>
                <Label Style="{StaticResource WhiteLabel}" Text="{Binding TradingData.LastMinute.Open, StringFormat='{0:c}'}" />
            </FlexLayout>
            <FlexLayout Direction="Column">
                <Label Style="{StaticResource WhiteLabel}" Text="Low"/>
                <Label Style="{StaticResource WhiteLabel}" Text="{Binding TradingData.LastMinute.Low, StringFormat='{0:c}'}" />
            </FlexLayout>
            <FlexLayout Direction="Column">
                <Label Style="{StaticResource WhiteLabel}" Text="High"/>
                <Label Style="{StaticResource WhiteLabel}" Text="{Binding TradingData.LastMinute.High, StringFormat='{0:c}'}" />
            </FlexLayout>
            <FlexLayout Direction="Column">
                <Label Style="{StaticResource WhiteLabel}" Text="Close"/>
                <Label Style="{StaticResource WhiteLabel}" Text="{Binding TradingData.LastMinute.Close, StringFormat='{0:c}'}" />
            </FlexLayout>

        </FlexLayout>

        <VerticalStackLayout Grid.Row="2">
            <Label Text="{Binding TradingData.LastTime}" />
            <Label Text="{Binding TradingData.LastTrade}" />
            <Label Text="{Binding TradingData.LastTime}" />
            <Label Text="{Binding TradingData.IsAfterHours}" />

        </VerticalStackLayout>

        <VerticalStackLayout Grid.Row="2" Grid.Column="1">
            <Label Text="{Binding TradingData.QuoteStatus}" />
            <Label Text="{Binding TradingData.ChangeClose}" />
            <Label Text="{Binding TradingData.ChangeClosePercentage}" />
            <Label Text="{Binding TradingData.TotalVolume}" />

        </VerticalStackLayout>

        <VerticalStackLayout Grid.ColumnSpan="2" VerticalOptions="Center" IsVisible="{Binding IsTraderStopped}">
            <Label
               Text="Enter a ticker symbol to start"
               HorizontalOptions="Center"
               VerticalOptions="Center"
               />
            <Entry Placeholder="Ticker" 
                   Text="{Binding Symbol}"
                   HeightRequest="50" WidthRequest="100" Margin="20" />
            <Button Text="GO" 
                    Command="{Binding StartTradingCommand}"
                     HeightRequest="30" WidthRequest="50" />
        </VerticalStackLayout>



        <FlexLayout Grid.Row="3" Grid.ColumnSpan="2" 
                    JustifyContent="SpaceAround" 
                    Direction="Row"
                    AlignItems="Center"
                    BackgroundColor="MediumPurple"
                    IsVisible="{Binding IsTraderRunning}">

            <FlexLayout Direction="Column" JustifyContent="Center" AlignItems="Center">
                <Label Style="{StaticResource WhiteLabel}" Text="Requests"/>
                <Label Style="{StaticResource WhiteLabel}" Text="{Binding Trade.SessionData.TotalRequests}" />
            </FlexLayout>

            <Label Text="{Binding ErrorMessage}" IsVisible="{Binding HasError}" />

            <FlexLayout Direction="Column" JustifyContent="Center" AlignItems="Center">
                <Label Style="{StaticResource WhiteLabel}" Text="Response Time"/>
                <Label Style="{StaticResource WhiteLabel}" Text="{Binding Trade.SessionData.LastQuoteResponseTime, StringFormat='{0:fff}ms'}" />
            </FlexLayout>

            <Button WidthRequest="100" HeightRequest="30" IsVisible="{Binding IsTraderRunning}" Text="debug" Command="{Binding DebugCommand}"/>

        </FlexLayout>



    </Grid>

</ContentPage>